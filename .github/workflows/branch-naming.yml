# .github/workflows/branch-naming-convention.yml
name: Branch Naming Convention

on:
  create:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  issues: read
  pull-requests: read

jobs:
  check-branch-name:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name
        run: |
          branch_name="${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}"
          
          # LMJ : main branch always passes
          if [[ "$branch_name" == "main" ]]; then
            echo "âœ… Main branch"
            exit 0
          fi
          
          # LMJ : Check branch naming convention (with issue number)
          if [[ "$branch_name" =~ ^(feature|bugfix|hotfix|error-fix|fix|refactor|docs|csvs|test|chore|release)/[0-9]+-[a-z0-9-]+$ ]]; then
            echo "âœ… Branch name follows convention: $branch_name"
            ISSUE_NUMBER=$(echo $branch_name | grep -oP '(?<=/)[0-9]+(?=-)')
            BRANCH_TYPE=$(echo $branch_name | cut -d'/' -f1)
            DESCRIPTION=$(echo $branch_name | cut -d'/' -f2 | cut -d'-' -f2-)
            
            echo "ðŸ“‹ Branch details:"
            echo "  Type: $BRANCH_TYPE"
            echo "  Issue: #$ISSUE_NUMBER"
            echo "  Description: $DESCRIPTION"
            
            # LMJ : Note - Issue existence is validated by pr-issue-link-check.yml
            echo ""
            echo "ðŸ’¡ Issue existence will be validated by PR-Issue Link Check workflow"
            
          else
            echo "âŒ Branch name doesn't follow convention: $branch_name"
            echo ""
            echo "ðŸ“ Expected format: type/issue-number-description-with-hyphens"
            echo ""
            echo "âœ… Valid types:"
            echo "  â€¢ feature (ìƒˆ ê¸°ëŠ¥)"
            echo "  â€¢ bugfix (ë²„ê·¸ ìˆ˜ì •)"
            echo "  â€¢ hotfix (ê¸´ê¸‰ ìˆ˜ì •)"
            echo "  â€¢ error-fix (ì—ëŸ¬ ìˆ˜ì •)"
            echo "  â€¢ fix (ìˆ˜ì •)"
            echo "  â€¢ refactor (ì½”ë“œ ê°œì„ )"
            echo "  â€¢ docs (ë¬¸ì„œ ìž‘ì—…)"
            echo "  â€¢ csvs (ë°ì´í„° ìž‘ì—…)"
            echo "  â€¢ test (í…ŒìŠ¤íŠ¸ ì¶”ê°€)"
            echo "  â€¢ chore (ê¸°íƒ€ ìž‘ì—…)"
            echo "  â€¢ release (ë¦´ë¦¬ì¦ˆ)"
            echo ""
            echo "âœ… Format rules:"
            echo "  â€¢ Must include issue number after type"
            echo "  â€¢ Only lowercase letters (a-z)"
            echo "  â€¢ Numbers (0-9)"
            echo "  â€¢ Hyphens (-) instead of spaces"
            echo ""
            echo "ðŸ“Œ Examples:"
            echo "  â€¢ feature/123-user-authentication"
            echo "  â€¢ bugfix/456-login-error-fix"
            echo "  â€¢ fix/789-null-pointer-exception"
            echo "  â€¢ csvs/42-update-character-stats"
            exit 1
          fi
        env:
          GH_TOKEN: ${{ github.token }}
